
var wlClient;(function(wlClient){var WLClient=(function(){function WLClient(){this.localEcho=false;this.isConnected=false;this.isInactive=false;this.messagesReceivedWhileInactive=0;this.ansi_up=null;this.menuHandler=null;this.gmcpHandler=null;this.macros=null;this.micromodal=null;this.ansiRegex=null;this.sock=null;this.pending='';this.tty_neg_index=0;this.pwMode=false;this.inputHistoryIdx=-1;this.inputHistoryMax=20;this.inputHistoryTmp='';this.inputHistory=[];this.cmdButtons={};}
WLClient.prototype.connected=function(){this.isConnected=true;console.log('Connected.');};WLClient.prototype.disconnected=function(){this.isConnected=false;console.log('Disconnected.');};WLClient.prototype.initDefaultCmdButtons=function(){return{"cmdbt8":{type:1,order:0,cmds:{'1':{'label':'wer','cmd':'wer','send':true}}},"cmdbt7":{type:1,order:1,cmds:{'1':{'label':'schau','cmd':'schau','send':true}}},"cmdbt6":{type:1,order:2,cmds:{'1':{'label':'inventar','cmd':'inv','send':true}}},"cmdbt5":{type:1,order:3,cmds:{'1':{'label':'info','cmd':'info','send':true}}},"cmdbt4":{type:1,order:4,cmds:{'1':{'label':'- ...','cmd':'- ','send':false}}},"cmdbt3":{type:1,order:5,cmds:{'1':{'label':'oben','cmd':'oben','send':true}}},"cmdbt2":{type:4,order:6,cmds:{'1':{'label':'n','cmd':'n','send':true},'2':{'label':'s','cmd':'s','send':true},'3':{'label':'o','cmd':'o','send':true},'4':{'label':'w','cmd':'w','send':true},}},"cmdbt1":{type:1,order:7,cmds:{'1':{'label':'unten','cmd':'unten','send':true}}},};};;WLClient.prototype.getCmdButtonLabels=function(buttonId){var primaryId=buttonId.split('.')[0];if(this.cmdButtons[primaryId]!=null){return Object.keys(this.cmdButtons[primaryId].cmds).map(function(cmdId){return this.cmdButtons[primaryId].cmds[cmdId].label;}.bind(this));}
else{return[];}};WLClient.prototype.removeCmdButton=function(buttonId){var primaryId=buttonId.split('.')[0];var secondaryId=buttonId.split('.')[1];if(this.cmdButtons[primaryId]!=null&&this.cmdButtons[primaryId].cmds[secondaryId]!=null){delete this.cmdButtons[primaryId];this.saveSettings();}
else{console.log('Unknown button to remove: '+buttonId+'');}};WLClient.prototype.editCmdButton=function(buttonId,label,cmd,send){var primaryId=buttonId.split('.')[0];var secondaryId=buttonId.split('.')[1];if(this.cmdButtons[primaryId]!=null&&this.cmdButtons[primaryId].cmds[secondaryId]!=null){this.cmdButtons[primaryId].cmds[secondaryId].label=label;this.cmdButtons[primaryId].cmds[secondaryId].cmd=cmd;this.cmdButtons[primaryId].cmds[secondaryId].send=send;this.saveSettings();}
else{console.log('Unknown button to edit: '+buttonId+' ('+label+','+cmd+','+send+')');}};WLClient.prototype.getHighestCmdButtonOrderValue=function(){var highest=0;var cmdIds=Object.keys(this.cmdButtons);for(var i=0;i<cmdIds.length;i++){var tmpOrder=this.cmdButtons[cmdIds[i]].order;if(tmpOrder>highest)
highest=tmpOrder;}
return highest;};WLClient.prototype.getInsertableCmdButtonOrderValue=function(followingCmdButtonId){var _this=this;var primaryId=followingCmdButtonId.split('.')[0];var insOrder=-1;var cmdIds=Object.keys(this.cmdButtons).sort(function(c1,c2){return _this.cmdButtons[c1].order-_this.cmdButtons[c2].order;});for(var i=0;i<cmdIds.length;i++){if(cmdIds[i]==primaryId){insOrder=this.cmdButtons[primaryId].order;}
if(insOrder>=0)
this.cmdButtons[cmdIds[i]].order++;}
if(insOrder<0)
insOrder=0;return insOrder;};WLClient.prototype.add1CmdButton=function(selectedButtonId){var num=1;while(this.cmdButtons['cmdbt'+num]!=null)
num++;var newId='cmdbt'+num;var order=1000;if(selectedButtonId=='settings'){order=this.getHighestCmdButtonOrderValue()+1;}
else{order=this.getInsertableCmdButtonOrderValue(selectedButtonId);}
this.cmdButtons[newId]={type:1,order:order,cmds:{'1':{'label':'neu','cmd':'neu','send':true}}};this.saveSettings();};WLClient.prototype.add4CmdButton=function(selectedButtonId){var num=1;while(this.cmdButtons['cmdbt'+num]!=null)
num++;var newId='cmdbt'+num;var order=1000;if(selectedButtonId=='settings'){order=this.getHighestCmdButtonOrderValue()+1;}
else{order=this.getInsertableCmdButtonOrderValue(selectedButtonId);}
this.cmdButtons[newId]={type:4,order:order,cmds:{'1':{'label':'n','cmd':'n','send':true},'2':{'label':'s','cmd':'s','send':true},'3':{'label':'o','cmd':'o','send':true},'4':{'label':'w','cmd':'w','send':true},}};this.saveSettings();};WLClient.prototype.parseQuery=function(qstr){var query={};var a=qstr.substr(1).split('&');for(var i=0;i<a.length;i++){var b=a[i].split('=');query[decodeURIComponent(b[0])]=decodeURIComponent(b[1]||'');}
return query;};WLClient.prototype.bildstoerung=function(){var img_a=document.querySelector('a#room_image_a');var img=document.querySelector('img#room_image');var brokenPath=img.getAttribute('src');if(brokenPath!='img/aaa_no_signal.jpg'){img.setAttribute('src','img/aaa_no_signal.jpg');img.setAttribute('alt','Bildstoerung: '+brokenPath+' is broken!');img_a.setAttribute('href','img/aaa_no_signal.jpg');img_a.setAttribute('data-title','Bildstoerung: '+brokenPath+' is broken!');}};WLClient.prototype.updateClientTitle=function(){if(this.isInactive){if(this.messagesReceivedWhileInactive>0)
document.title="WL ("+this.messagesReceivedWhileInactive+")";else
document.title="WL (-)";}
else{this.messagesReceivedWhileInactive=0;document.title="WL";}};WLClient.prototype.writeToScreen=function(str){if(str&&str.length>0){var out=document.getElementById('out');out.insertAdjacentHTML('beforeend',str);out.scrollTop=out.scrollHeight;while(out.childNodes.length>1000)
out.childNodes[0].remove();if(this.isInactive)
this.messagesReceivedWhileInactive++;this.updateClientTitle();}};WLClient.prototype.doTelnetNegotions=function(sock,buf){var IAC='\xff';var DONT='\xfe';var DO='\xfd';var WONT='\xfc';var WILL='\xfb';var SB='\xfa';var SE='\xf0';var EOR='\xef';var TELOPT_ECHO='\x01';var TELOPT_STATUS='\x05';var TELOPT_TTYPE='\x18';var TELOPT_EOR='\x19';var TELOPT_TSPEED='\x20';var TELOPT_LINEMODE='\x22';var TELOPT_XDISPLOC='\x23';var TELOPT_ENVIRON='\x24';var TELOPT_CHARSET='\x2a';var TELOPT_GMCP='\xc9';var TELQUAL_IS='\x00';var TELQUAL_SEND='\x01';var tty_neg_types=['dumb','ansi','xterm','xterm-256color','xterm-direct'];var strippedBuf='';buf=this.pending+buf;this.pending='';var len=buf.length;if(len>0){var oldIacIdx=0;var newIacIdx=0;while((newIacIdx=buf.indexOf(IAC,oldIacIdx))>=0){strippedBuf+=buf.substr(oldIacIdx,newIacIdx-oldIacIdx);if(newIacIdx<len&&buf[newIacIdx+1]==EOR){var startOfPrompt=strippedBuf.lastIndexOf('\n',len);var prmpt=strippedBuf.substr(startOfPrompt+1);if(prmpt.length>0){if(startOfPrompt<0)
strippedBuf='';else
strippedBuf=strippedBuf.substr(0,startOfPrompt+1);this.setPrompt(this.ansi_up.ansi_to_html(prmpt));}
oldIacIdx=newIacIdx+2;}
else if(newIacIdx+2>=len){this.pending=buf.substr(newIacIdx);oldIacIdx=len;}
else{switch(buf[newIacIdx+1]){case DONT:oldIacIdx=newIacIdx+3;break;case DO:switch(buf[newIacIdx+2]){case TELOPT_TTYPE:if(sock)
sock.emit('stream',IAC+WILL+TELOPT_TTYPE);this.tty_neg_index=0;break;case TELOPT_TSPEED:case TELOPT_LINEMODE:case TELOPT_XDISPLOC:case TELOPT_ENVIRON:default:if(sock)
sock.emit('stream',IAC+WONT+buf.substr(newIacIdx+2,1));break;}
oldIacIdx=newIacIdx+3;break;case WONT:switch(buf[newIacIdx+2]){case TELOPT_ECHO:this.leavePWMode();if(sock)
sock.emit('stream',IAC+DONT+TELOPT_ECHO);break;default:if(sock)
sock.emit('stream',IAC+DONT+buf.substr(newIacIdx+2,1));break;}
oldIacIdx=newIacIdx+3;break;case WILL:switch(buf[newIacIdx+2]){case TELOPT_EOR:if(sock)
sock.emit('stream',IAC+DO+TELOPT_EOR);break;case TELOPT_ECHO:this.enterPWMode();if(sock)
sock.emit('stream',IAC+DO+TELOPT_ECHO);break;case TELOPT_GMCP:if(sock)
sock.emit('stream',IAC+DO+TELOPT_GMCP);if(sock)
sock.emit('stream',IAC+SB+TELOPT_GMCP+this.gmcpHandler.getGMCPHello()+IAC+SE);break;default:if(sock)
sock.emit('stream',IAC+DONT+buf.substr(newIacIdx+2,1));break;}
oldIacIdx=newIacIdx+3;break;case SB:var endSubNegIdx=buf.indexOf(SE,newIacIdx+2);if(endSubNegIdx<0){this.pending=buf.substr(newIacIdx);oldIacIdx=len;}
else{if(buf[newIacIdx+2]==TELOPT_GMCP){this.gmcpHandler.doGMCPReceive(this,sock,buf.substr(newIacIdx+3,endSubNegIdx-(newIacIdx+4)));}
else if(buf[newIacIdx+2]==TELOPT_TTYPE&&buf[newIacIdx+3]==TELQUAL_SEND){if(sock)
sock.emit('stream',IAC+SB+TELOPT_TTYPE+TELQUAL_IS+tty_neg_types[this.tty_neg_index]+IAC+SE);if(this.tty_neg_index+1<tty_neg_types.length)
this.tty_neg_index=this.tty_neg_index+1;}
else{console.log('Don\'t understand: [IAC+SB+('+buf.charCodeAt(newIacIdx+2)+')...]');}
oldIacIdx=endSubNegIdx+1;}
break;default:console.log('Don\'t understand: [IAC+('+buf.charCodeAt(newIacIdx+1)+')+('+buf.charCodeAt(newIacIdx+2)+')...]\n');oldIacIdx=newIacIdx+3;break;}}}
if(oldIacIdx+1<len)
strippedBuf+=buf.substr(oldIacIdx,len-oldIacIdx);}
return strippedBuf;};WLClient.prototype.writeServerData=function(buf){var line=this.ansi_up.ansi_to_html(buf);this.writeToScreen(line);};WLClient.prototype.adjustLayout=function(){var thePage=document.getElementById('page');var theOut=document.getElementById('out');var theInfo=document.getElementById('info');var theIn=document.getElementById('in');var page_width=thePage.clientWidth;var page_height=thePage.clientHeight;var info_width=theInfo.clientWidth;theIn.style.width=(page_width-(info_width+6))+'px';var in_outerheight=theIn.clientHeight;theOut.style.width=(page_width-(info_width+6))+'px';theOut.style.height=(page_height-in_outerheight-10)+'px';theOut.scrollTo(0,theOut.scrollHeight);};WLClient.prototype.saveSettings=function(){localStorage.setItem('Client.Setting.LocalEcho',JSON.stringify(this.localEcho));localStorage.setItem('Client.Setting.CmdButtons',JSON.stringify(this.cmdButtons));};WLClient.prototype.loadSettings=function(){this.macros.reloadSettings();var localEchoSetting=localStorage.getItem('Client.Setting.LocalEcho');if(localEchoSetting){try{this.localEcho=JSON.parse(localEchoSetting);}
catch(error){this.writeToScreen(''+error.name+' beim Verarbeiten der LocalEcho Einstellung: '+error.message+'\n');this.localEcho=false;}}
else{console.log('Verwende Standard-Einstellungen für LocalEcho.');this.localEcho=false;}
var cmdButtonsSetting=localStorage.getItem('Client.Setting.CmdButtons');if(cmdButtonsSetting){try{this.cmdButtons=JSON.parse(cmdButtonsSetting);}
catch(error){this.writeToScreen(''+error.name+' beim Verarbeiten der CmdButtons Einstellungen: '+error.message+'\n');this.cmdButtons=this.initDefaultCmdButtons();}}
else{console.log('Verwende Standard-Einstellungen für CmdButtons.');this.cmdButtons=this.initDefaultCmdButtons();}
document.querySelector('button#localecho').innerHTML='Local Echo: '+(this.localEcho==true?'an':'aus');};WLClient.prototype.processQueryParams=function(){var queryParams=this.parseQuery(document.location.search);var debugGMCP=queryParams['debug'];if(debugGMCP=='true')
this.gmcpHandler.debug_GMCP=true;var bgColor=queryParams['bg'];if(bgColor!=null){document.body.style.backgroundColor='#'+bgColor;}
var fgColor=queryParams['fg'];if(fgColor!=null){document.body.style.color='#'+fgColor;}
var infoBgColor=queryParams['ibg'];if(infoBgColor!=null){document.querySelector('div#info').style.backgroundColor='#'+infoBgColor;}
var infoFgColor=queryParams['ifg'];if(infoFgColor!=null){document.querySelector('div#info').style.color='#'+infoFgColor;document.querySelector('div#info').style.borderColor='#'+infoFgColor;}
var infoBorderColor=queryParams['ibc'];if(infoBorderColor!=null){document.querySelector('div#info').style.borderColor='#'+infoBorderColor;}
var infoPanel=queryParams['infopanel'];if(infoPanel==null||infoPanel!='hidden')
document.querySelector('div#info').style.visibility='visible';else
document.querySelector('div#info').style.visibility='hidden';console.log('URL-Paramters for infoPanel = '+infoPanel);};WLClient.prototype.doCookiePopup=function(){if(!document.cookie.split('; ').find(function(row){return row.startsWith('didAcceptCookies');})){document.querySelector('.cookie-bar').style.display='inline-block';}};WLClient.prototype.doCookieAccept=function(){var cookieDate=new Date();cookieDate.setTime(new Date().getTime()+2592000000);document.cookie="didAcceptCookies=true; path=/; expires="+cookieDate.toUTCString();};WLClient.prototype.importSettings=function(event){var hiddenInputElement=document.getElementById('importButtonHiddenInput');hiddenInputElement.onchange=this.uploadSettingsFile.bind(this);hiddenInputElement.click();};WLClient.prototype.uploadSettingsFile=function(e){var file=e.target.files[0];if(!file)
return;var reader=new FileReader();reader.onload=function(e){var settingsStr=e.target.result;if(settingsStr&&settingsStr.length>0){var settings;try{settings=JSON.parse(settingsStr);}
catch(e){this.writeToScreen(''+e.name+': '+e.message+'\n');}
if(settings&&Object.keys(settings).length>0){if(settings['#VERSION']==1){for(var i=0;i<localStorage.length;i++){var key=localStorage.key(i);if(key.substr(0,7)=='Client.'||key.substr(0,7)=='Macros.'){localStorage.removeItem(key);}}
var keys=Object.keys(settings);for(var i=0;i<keys.length;i++){var key=keys[i];if(key!='#VERSION'){localStorage.setItem(key,settings[key]);}}
this.writeToScreen('Einstellungen (V'+settings['#VERSION']+', #'+(keys.length-1)+') importiert.\n');this.loadSettings();}
else{this.writeToScreen('Einstellungen haben falsche Version.\n');}}
else{this.writeToScreen('Einstellungen leer.\n');}}
else{this.writeToScreen('Einstellungen konnten nicht importiert werden.\n');}
this.setFocusToInput();}.bind(this);reader.readAsText(file);};WLClient.prototype.exportSettings=function(event){var hiddenAnchorElement=document.getElementById('exportButtonHiddenAnchor');var settings={'#VERSION':1};for(var i=0;i<localStorage.length;i++){var key=localStorage.key(i);if(key.substr(0,7)=='Client.'||key.substr(0,7)=='Macros.'){settings[key]=localStorage.getItem(key);}}
var settingsStr=JSON.stringify(settings);hiddenAnchorElement.setAttribute('href','data:text/plain;charset=utf-8,'+encodeURIComponent(settingsStr));hiddenAnchorElement.click();this.writeToScreen('Einstellungen (V'+settings['#VERSION']+', #'+(Object.keys(settings).length-1)+') exportiert.\n');this.setFocusToInput();};WLClient.prototype.enterPWMode=function(){this.pwMode=true;this.menuHandler.closeAllDropDowns();document.getElementById('cmd').style.display='none';document.querySelector('.dropbtn').style.display='none';document.getElementById('pwd').style.display='block';this.setFocusToInput();};WLClient.prototype.leavePWMode=function(){this.pwMode=false;document.getElementById('pwd').style.display='none';document.querySelector('.dropbtn').style.display='block';document.getElementById('cmd').style.display='block';this.setFocusToInput();};WLClient.prototype.setFocusToInput=function(){if(this.pwMode)
document.getElementById('pwd').focus();else
document.getElementById('cmd').focus();};WLClient.prototype.setInput=function(cmd){if(this.pwMode)
document.getElementById('pwd').value=cmd;else
document.getElementById('cmd').value=cmd;};WLClient.prototype.setPrompt=function(prompt){document.getElementById('prompt').innerHTML=prompt;};WLClient.prototype.handleKeyDown=function(event){if(document.querySelector('.modal.is-open')!=null)
return;if(!this.pwMode){var result=this.macros.keyTrigger(event);var doSend=result.send;var msg=result.message;if(doSend){var cmd=result.cmd;if(cmd.length==0||cmd.charAt(cmd.length-1)!='\n')
cmd+='\n';this.send(cmd,this.pwMode);event.preventDefault();return true;}
else{var namedKey=this.macros.getNamedKey(event);if(namedKey.length>0){var cmd_1=document.getElementById('cmd');if(cmd_1.value&&cmd_1.value.substr(0,4).toLowerCase()=='/def'&&cmd_1.value.substr(cmd_1.value.length-4)=='key_'){cmd_1.value+=(namedKey.substr(4)+' = ');event.preventDefault();return true;}}}
if(msg.length>0)
this.writeToScreen(msg);}
if(event.key=='c'&&(event.ctrlKey||event.metaKey))
return true;if(['CapsLock','Shift','Tab','Escape','Control','Meta','Pause','Alt','PageUp','PageDown','Home','End','ArrowDown','ArrowLeft','ArrowRight','ArrowUp','Insert','F1','F2','F3','F4','F5','F6','F7','F8','F9','F10','F11','F12','F13','F14','F15','F16','F17','F18','F19','F20','NumLock','ScrollLock'].indexOf(event.key)!=-1)
return true;this.setFocusToInput();return true;};WLClient.prototype.sendInput=function(){var elem=(this.pwMode===true?document.getElementById('pwd'):document.getElementById('cmd'));var cmd=elem.value;if(cmd.length>0&&this.inputHistory.indexOf(cmd)!=0){if(!this.pwMode)
this.inputHistory.unshift(cmd);if(this.inputHistory.length>this.inputHistoryMax)
this.inputHistory.pop();}
this.inputHistoryIdx=-1;var doSend=true;if(!this.pwMode){var result=this.macros.resolve(cmd);doSend=result.send;cmd=result.cmd;var msg=result.message;if(msg.length>0)
this.writeToScreen(msg);}
if(cmd.length==0||cmd.charAt(cmd.length-1)!='\n')
cmd+='\n';if(doSend)
this.send(cmd,this.pwMode);elem.value='';elem.dispatchEvent(new Event('change'));};WLClient.prototype.configureCmdButtons=function(){var _this=this;var mainDropdown=document.querySelector('div#mainDropdown');while(mainDropdown.firstChild!=null&&mainDropdown.firstChild.id!='settings'){mainDropdown.removeChild(mainDropdown.firstChild);}
var buttonKeys=Object.keys(this.cmdButtons).sort(function(c1,c2){return _this.cmdButtons[c2].order-_this.cmdButtons[c1].order;});var newButton=null;for(var i=0;i<buttonKeys.length;i++){if(this.cmdButtons[buttonKeys[i]].type==1){newButton=document.createElement("button");newButton.id=buttonKeys[i]+'.1';newButton.className='drp';newButton.addEventListener('contextmenu',this.menuHandler.cmdButtonContextFunction,false);newButton.innerHTML=this.cmdButtons[buttonKeys[i]]['cmds']['1'].label;newButton.dataset.send=this.cmdButtons[buttonKeys[i]]['cmds']['1'].send;newButton.dataset.cmd=this.cmdButtons[buttonKeys[i]]['cmds']['1'].cmd;newButton.addEventListener('click',function(e){var currentTarget=e.currentTarget;this.setInput(currentTarget.dataset.cmd);if(currentTarget.dataset.send=='true')
this.sendInput();this.setFocusToInput();}.bind(this));}
else if(this.cmdButtons[buttonKeys[i]].type==4){newButton=document.createElement("div");newButton.className='drp nohover';newButton.style.whiteSpace='nowrap';newButton.style.overflow='hidden';for(var k=1;k<=4;k++){var subButton=document.createElement("button");subButton.id=buttonKeys[i]+'.'+k;subButton.className='drp drpssub4'+k;subButton.addEventListener('contextmenu',this.menuHandler.cmdButtonContextFunction,false);subButton.innerHTML=this.cmdButtons[buttonKeys[i]]['cmds'][''+k].label;subButton.dataset.send=this.cmdButtons[buttonKeys[i]]['cmds'][''+k].send;subButton.dataset.cmd=this.cmdButtons[buttonKeys[i]]['cmds'][''+k].cmd;newButton.insertBefore(subButton,null);subButton.addEventListener('click',function(e){var currentTarget=e.currentTarget;this.setInput(currentTarget.dataset.cmd);if(currentTarget.dataset.send=='true')
this.sendInput();this.setFocusToInput();}.bind(this));}}
mainDropdown.insertBefore(newButton,mainDropdown.firstChild);}};WLClient.prototype.cmdEditButtonClicked=function(params){var ctxMenuButton=params.target;var cmdButtonId=ctxMenuButton.dataset.cmdButtonId;document.getElementById('cmdButtonEditModalDlg-saveButton').dataset.cmdButtonId=cmdButtonId;var cmdButton=document.getElementById(cmdButtonId);document.querySelector('input#buttonName').value=cmdButton.innerHTML;document.querySelector('input#buttonCmd').value=cmdButton.dataset.cmd;document.querySelector('input#buttonSend').checked=(cmdButton.dataset.send=='true');this.micromodal.show('cmdButtonEditModalDlg');};WLClient.prototype.cmdRemoveButtonClicked=function(params){var ctxMenuButton=params.currentTarget;var cmdButtonId=ctxMenuButton.dataset.cmdButtonId;if(cmdButtonId!="settings"){var labels=this.getCmdButtonLabels(cmdButtonId);if(labels.length==1){document.getElementById('yesnoModalDlg-title').innerHTML='Kommando-Button entfernen?';document.getElementById('yesnoModalDlg-content').innerHTML='Willst Du den Button <br><div class="fakedrp">'+labels[0]+'</div><br> wirklich entfernen?';}
else{document.getElementById('yesnoModalDlg-title').innerHTML='Kommando-Buttons entfernen?';var content='Willst Du die Button-Zeile<br><div class="fakedrp" style="white-space: nowrap;overflow:hidden;background-color:transparent;width: auto;">';for(var i=0;i<labels.length;i++){content+='<div class="fakedrp fakedrpssub4'+(i+1)+'">'+labels[i]+'</div>';}
content+='</div><br>wirklich entfernen?';document.getElementById('yesnoModalDlg-content').innerHTML=content;}
var yesButton=document.getElementById('yesnoModalDlg-yesButton');yesButton.dataset.cmdButtonId=cmdButtonId;yesButton.addEventListener('click',function name(params){var yesButton=params.target;var cmdButtonId=yesButton.dataset.cmdButtonId;this.removeCmdButton(cmdButtonId);this.configureCmdButtons();this.micromodal.close('yesnoModalDlg');}.bind(this));this.micromodal.show('yesnoModalDlg');}
else{document.getElementById('infoModalDlg-title').innerHTML='Hinweis';document.getElementById('infoModalDlg-content').innerHTML='Der \'Optionen\' Button darf nicht entfernt werden.';this.micromodal.show('infoModalDlg');}};WLClient.prototype.cmdAdd1ButtonClicked=function(params){var ctxMenuButton=params.target;var cmdButtonId=ctxMenuButton.dataset.cmdButtonId;this.add1CmdButton(cmdButtonId);this.configureCmdButtons();};WLClient.prototype.cmdAdd4ButtonClicked=function(params){var ctxMenuButton=params.target;var cmdButtonId=ctxMenuButton.dataset.cmdButtonId;this.add4CmdButton(cmdButtonId);this.configureCmdButtons();};WLClient.prototype.handleInputKeyDowns=function(e){var target=e.currentTarget;switch(e.key){case'ArrowLeft':break;case'ArrowUp':if(this.inputHistory.length>=0&&(this.inputHistoryIdx+1)<this.inputHistory.length){if(this.inputHistoryIdx<0){this.inputHistoryTmp=target.value;}
this.inputHistoryIdx++;target.value=this.inputHistory[this.inputHistoryIdx];}
break;case'ArrowRight':break;case'ArrowDown':if(this.inputHistoryIdx>=0){this.inputHistoryIdx--;if(this.inputHistoryIdx<0){target.value=this.inputHistoryTmp;}
else{if(this.inputHistoryIdx<this.inputHistory.length){target.value=this.inputHistory[this.inputHistoryIdx];}}}
break;case'Enter':e.preventDefault();this.sendInput();break;}};WLClient.prototype.send=function(str,isPassword){if(this.localEcho===true){var viewStr;if(str.length>0&&isPassword)
viewStr=new Array(str.length+1).join('*');else
viewStr=str;this.writeToScreen(viewStr);}
if(this.sock)
this.sock.emit('stream',str);};WLClient.prototype.handleBackspace=function(str){var bs=str.indexOf('\b');if(bs>=0){var newstr=str.substr(0,(bs-1))+str.substr(bs+1);return this.handleBackspace(newstr);}
return str;};WLClient.prototype.stripAnsi=function(str){return str.replace(this.ansiRegex(),'');};WLClient.prototype.startClient=function(){this.micromodal=require('micromodal');this.micromodal.init();this.ansiRegex=require('ansi-regex');var AnsiUp=require('ansi_up').default;this.ansi_up=new AnsiUp;this.menuHandler=new wlClient.MenuHandler();this.gmcpHandler=new wlClient.GMCPHandler();this.macros=new wlMacros.MacroProcessor();console.log(this.macros);var io=require("socket.io");window.addEventListener('resize',this.adjustLayout);window.addEventListener("blur",function(e){if(!this.isInactive){this.isInactive=true;this.updateClientTitle();}}.bind(this));window.addEventListener("focus",function(e){if(this.isInactive){this.isInactive=false;this.updateClientTitle();}}.bind(this));window.addEventListener("beforeunload",function(e){if(this.isConnected){e.preventDefault();e.returnValue='';}}.bind(this));window.addEventListener('keydown',this.handleKeyDown.bind(this));window.addEventListener('mouseup',function(e){if(document.querySelector('.modal.is-open')!=null)
return;if(!window.getSelection()||window.getSelection().toString().length==0){this.setFocusToInput();}}.bind(this));this.ansi_up.use_classes=true;this.loadSettings();this.processQueryParams();var httpRequest=new XMLHttpRequest();httpRequest.onreadystatechange=function(event){var req=event.currentTarget;if(req.readyState===XMLHttpRequest.DONE){if(req.responseText){var lines=req.responseText.split('\n');for(var i=0;i<lines.length;i++){this.writeToScreen(lines[i]+'<br/>');}}
else{console.log('XMLHttpRequest.responseText is empty!');}}}.bind(this);httpRequest.open('GET','help.txt');httpRequest.send();document.getElementById('room_image').addEventListener('error',this.bildstoerung.bind(this),false);var baseUri=location.pathname.substring(0,location.pathname.lastIndexOf("/"));this.sock=io.connect('',{path:baseUri+'/socket.io',closeOnBeforeunload:false});this.sock.on('stream',function(buf){buf=this.doTelnetNegotions(this.sock,buf);buf=this.handleBackspace(buf);this.writeServerData(buf);var result=this.macros.textTrigger(this.stripAnsi(buf));var doSend=result.send;var msg=result.message;if(doSend){var cmd=result.cmd;if(cmd.length==0||cmd.charAt(cmd.length-1)!='\n')
cmd+='\n';this.send(cmd,this.pwMode);}
if(msg.length>0)
this.writeToScreen(msg);}.bind(this));this.sock.on('connected',function(){this.writeToScreen('Verbindung zum Wunderland hergestellt.\n');this.connected();}.bind(this));this.sock.on('disconnected',function(){this.writeToScreen('Verbindung zum Wunderland verloren. (Enter: neu verbinden)\n');this.leavePWMode();this.setPrompt('&gt; ');this.disconnected();}.bind(this));window.addEventListener('click',this.menuHandler.closeAllButtonContextFunction);document.getElementById('checkbox-cb').addEventListener('click',this.doCookieAccept.bind(this),false);this.doCookiePopup();this.setFocusToInput();document.getElementById('cmd').addEventListener('keydown',this.handleInputKeyDowns.bind(this),false);document.getElementById('pwd').addEventListener('keydown',this.handleInputKeyDowns.bind(this),false);document.querySelector('button#settings').addEventListener('click',this.menuHandler.settingsDropDownFunction.bind(this),false);document.querySelector('button#settings').addEventListener('contextmenu',this.menuHandler.settingsButtonContextFunction.bind(this),false);this.configureCmdButtons();document.getElementById('cmdEdit').addEventListener('click',this.cmdEditButtonClicked.bind(this),false);document.getElementById('cmdRemove').addEventListener('click',this.cmdRemoveButtonClicked.bind(this),false);document.getElementById('cmdAdd1').addEventListener('click',this.cmdAdd1ButtonClicked.bind(this),false);document.getElementById('cmdAdd4').addEventListener('click',this.cmdAdd4ButtonClicked.bind(this),false);document.getElementById('settingsAdd1').addEventListener('click',this.cmdAdd1ButtonClicked.bind(this),false);document.getElementById('settingsAdd4').addEventListener('click',this.cmdAdd4ButtonClicked.bind(this),false);document.getElementById('cmdButtonEditModalDlg-saveButton').addEventListener('click',function name(params){var dlgSaveButton=params.target;var cmdButtonId=dlgSaveButton.dataset.cmdButtonId;var cmdButton=document.getElementById(cmdButtonId);var label=document.querySelector('input#buttonName').value;cmdButton.innerHTML=label;var cmd=document.querySelector('input#buttonCmd').value;cmdButton.dataset.cmd=cmd;var send=document.querySelector('input#buttonSend').checked;cmdButton.dataset.send=send.toString();this.editCmdButton(cmdButtonId,label,cmd,send);this.micromodal.close('cmdButtonEditModalDlg');}.bind(this));document.querySelector('button#importButton').addEventListener('click',this.importSettings.bind(this),false);document.querySelector('button#exportButton').addEventListener('click',this.exportSettings.bind(this),false);document.querySelector('button#colors').addEventListener('click',function(e){this.writeToScreen('Farbeinstellungen: (geht noch nicht)\n');this.setFocusToInput();}.bind(this),false);document.querySelector('button#localecho').addEventListener('click',function(e){this.localEcho=!this.localEcho;this.saveSettings();this.writeToScreen('Lokales Echo ist jetzt '+(this.localEcho==true?'an':'aus')+'.\n');document.querySelector('button#localecho').innerHTML='Local Echo: '+(this.localEcho==true?'an':'aus')+'';this.setFocusToInput();}.bind(this),false);document.querySelector('button#helpButton').addEventListener('click',function(e){window.open('/webclient/help.html','_blank');},false);document.querySelector('button#clear').addEventListener('click',function(e){var out=document.getElementById('out');while(out.firstChild)
out.removeChild(out.lastChild);this.setFocusToInput();}.bind(this),false);document.getElementById('out').click();setTimeout(function(){this.adjustLayout();this.send('\n',false);}.bind(this),200);};return WLClient;}());wlClient.WLClient=WLClient;})(wlClient||(wlClient={}));var wlClient;(function(wlClient){var GMCPHandler=(function(){function GMCPHandler(){this.debug_GMCP=false;this.living_room_image='';this.living_room_name='';this.staticContentBase='/webclient/';this.micromodal=null;this.clientInstance=null;this.socketInstance=null;this.editorWindow=null;this.WLFileReceiveBuffer={};this.popupCenter=function(_a){var url=_a.url,title=_a.title,w=_a.w,h=_a.h;var dualScreenLeft=window.screenLeft!==undefined?window.screenLeft:window.screenX;var dualScreenTop=window.screenTop!==undefined?window.screenTop:window.screenY;var width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var systemZoom=width/window.screen.availWidth;var left=(width-w)/2/systemZoom+dualScreenLeft;var top=(height-h)/2/systemZoom+dualScreenTop;var windowHandle=window.open(url,title,"\n                toolbar=no,\n                scrollbars=yes,\n                width=w / systemZoom,\n                height=h / systemZoom,\n                top=top,\n                left=left\n                ");return windowHandle;};this.micromodal=require('micromodal');this.micromodal.init();window.onunload=function(event){if(this.editorWindow&&!this.editorWindow.closed){this.editorWindow.updateClient(null,null);}}.bind(this);var cleanupWLFileReceiveBufferTimer=setInterval(this.CleanupWLFileReceiveBuffer.bind(this),10000);}
GMCPHandler.prototype.getSocket=function(){return this.socketInstance;};GMCPHandler.prototype.pad=function(str,pad_str,max){str=str.toString();return str.length<max?this.pad(pad_str.toString()+str,pad_str,max):str;};GMCPHandler.prototype.numberWithDots=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");};GMCPHandler.prototype.getGMCPHello=function(){return'Core.Hello { \"client\": \"WL@Web\", \"version\": \"1.3.1\" }';};GMCPHandler.prototype.doGMCPReceive=function(client,sock,data){this.clientInstance=client;this.socketInstance=sock;if(data.length>0){if(this.debug_GMCP)
client.writeToScreen('GMCP: '+data+'<br>');if(this.editorWindow&&!this.editorWindow.closed){this.editorWindow.updateClient(window,this);}
var module=data.split(' ',1)[0];var payload=data.substr(module.length);switch(module){case'Core.Ping':this.HandleGMCP_Core_Ping(sock,module,payload);break;case'Core.Goodbye':this.HandleGMCP_Core_Goodbye(sock,module,payload);break;case'Char.Vitals':this.HandleGMCP_Char_Vitals(sock,module,payload);break;case'Room.Info':this.HandleGMCP_Room_Info(sock,module,payload);break;case'WL.File.List':this.HandleGMCP_WL_File_List(sock,module,payload);break;case'WL.File.Transfer':this.HandleGMCP_WL_File_Transfer(sock,module,payload);break;default:console.log('Unknown GMCP module: '+module+'.');}}};GMCPHandler.prototype.HandleGMCP_Core_Ping=function(sock,module,payload){};GMCPHandler.prototype.HandleGMCP_Core_Goodbye=function(sock,module,payload){var value=JSON.parse(payload);if(value!=0){document.querySelector('span#room_name').textContent=value;}
document.querySelector('img#room_image').setAttribute('src',this.staticContentBase+'img/aaa_no_signal.jpg');document.querySelector('img#room_image').setAttribute('alt','Bildstoerung');document.querySelector('a#room_image_a').setAttribute('href',this.staticContentBase+'img/aaa_no_signal.jpg');document.querySelector('a#room_image_a').setAttribute('data-title','Bildstoerung');if(this.editorWindow&&!this.editorWindow.closed){this.editorWindow.updateClient(window,this);}};GMCPHandler.prototype.HandleGMCP_Char_Vitals=function(sock,module,payload){var values=JSON.parse(payload);if('ghost'in values&&values['ghost']=='1'){var img_a=document.querySelector('a#room_image_a');var img=document.querySelector('img#room_image');img.setAttribute('src',this.staticContentBase+'img/std/tod.jpg');img.setAttribute('alt','DU BIST TOT!');img_a.setAttribute('href',this.staticContentBase+'img/std/tod.jpg');img_a.setAttribute('data-title','DU BIST TOT!');document.querySelector('span#room_name').textContent='DU BIST TOT!';}
if('ghost'in values&&values['ghost']=='0'){var img_a=document.querySelector('a#room_image_a');var img=document.querySelector('img#room_image');if(this.living_room_image==''){img.setAttribute('src',this.staticContentBase+'img/aaa_no_signal.jpg');img.setAttribute('alt','Bildstoerung');img_a.setAttribute('href',this.staticContentBase+'img/aaa_no_signal.jpg');img_a.setAttribute('data-title','Bildstoerung');}
else{img.setAttribute('src',this.staticContentBase+this.living_room_image);img.setAttribute('alt',this.living_room_name);img_a.setAttribute('href',this.staticContentBase+this.living_room_image);img_a.setAttribute('data-title',this.living_room_name);}
document.querySelector('span#room_name').textContent=this.living_room_name;}
if('xp'in values){document.querySelector('span#xp.info').textContent=this.numberWithDots(values['xp']);}
if('hp'in values){document.querySelector('span#hp.info').textContent=values['hp'];}
if('max_hp'in values){document.querySelector('span#max_hp.info').textContent=values['max_hp'];}
if('sp'in values){document.querySelector('span#sp.info').textContent=values['sp'];}
if('max_sp'in values){document.querySelector('span#max_sp.info').textContent=values['max_sp'];}
if('questpoints'in values){document.querySelector('span#questpoints.info').textContent=values['questpoints'];}
if('max_questpoints'in values){document.querySelector('span#max_questpoints.info').textContent=values['max_questpoints'];}
if('wimpy'in values){document.querySelector('span#wimpy.info').textContent=values['wimpy'];}
if('wimpy_dir'in values){if(values['wimpy_dir']==''||values['wimpy_dir']=='0')
document.querySelector('span#wimpy_dir.info').textContent='keine';else
document.querySelector('span#wimpy_dir.info').textContent=values['wimpy_dir'];}
if('int'in values){document.querySelector('span#int.info').textContent=values['int'];}
if('str'in values){document.querySelector('span#str.info').textContent=values['str'];}
if('dex'in values){document.querySelector('span#dex.info').textContent=values['dex'];}
if('con'in values){document.querySelector('span#con.info').textContent=values['con'];}};GMCPHandler.prototype.HandleGMCP_Room_Info=function(sock,module,payload){var values=JSON.parse(payload);if('name'in values){this.living_room_name=values['name'];document.querySelector('span#room_name').textContent=this.living_room_name;}
if('image'in values){this.living_room_image=values['image'];var img_a=document.querySelector('a#room_image_a');var img=document.querySelector('img#room_image');if(this.living_room_image==''){img.setAttribute('src',this.staticContentBase+'img/aaa_no_signal.jpg');img.setAttribute('alt','Bildstoerung');img_a.setAttribute('href',this.staticContentBase+'img/aaa_no_signal.jpg');img_a.setAttribute('data-title','Bildstoerung');}
else{img.setAttribute('src',this.staticContentBase+this.living_room_image);img_a.setAttribute('href',this.staticContentBase+this.living_room_image);if('name'in values){img.setAttribute('alt',this.living_room_name);img_a.setAttribute('data-title',this.living_room_name);}}}};GMCPHandler.prototype.CleanupWLFileReceiveBuffer=function(){var allEntries=Object.keys(this.WLFileReceiveBuffer);for(var i=0;i<allEntries.length;i++){if(this.WLFileReceiveBuffer[allEntries[i]]["lastUpdate"]+30000<Date.now()){delete this.WLFileReceiveBuffer[allEntries[i]];console.log('Timeout reached for reception of: '+allEntries[i]);}}};GMCPHandler.prototype.HandleGMCP_WL_File_List=function(sock,module,payload){var _this=this;var values=JSON.parse(payload);if(!this.editorWindow||this.editorWindow.closed){this.editorWindow=this.popupCenter({url:'editor/',title:'Editor',w:900,h:500});this.editorWindow.setTimeout(function(){_this.editorWindow.updateClient(window,_this);_this.editorWindow.focus();},3000);}
else{this.editorWindow.updateClient(window,this);}
var path=values['path'];var list=values['list'];localStorage.setItem('WL.File.List path',path);localStorage.setItem('WL.File.List list',JSON.stringify(list));if(!this.editorWindow||this.editorWindow.closed){document.getElementById('infoModalDlg-title').innerHTML='Fehler!';document.getElementById('infoModalDlg-content').innerHTML='Editor-Fenster konnte nicht '+'ge&ouml;ffnet werden oder ist nicht sichtbar! Pr&uuml;fe Deinen Browser oder Popup-Blocker!';this.micromodal.show('infoModalDlg');}};GMCPHandler.prototype.HandleGMCP_WL_File_Transfer=function(sock,module,payload){var _this=this;var values=JSON.parse(payload);if(!this.editorWindow||this.editorWindow.closed){this.editorWindow=this.popupCenter({url:'editor/',title:'Editor',w:900,h:500});this.editorWindow.setTimeout(function(){_this.editorWindow.updateClient(window,_this);_this.editorWindow.focus();},3000);}
else{this.editorWindow.updateClient(window,this);}
var path=values['path'];var offset=values['offset'];var eof=values['eof'];var content=values['content'];if(!path){console.log("Received invalid WL.File.Transfer without 'path'.");return;}
if(!this.WLFileReceiveBuffer[path]){this.WLFileReceiveBuffer[path]={"type":"file","lastUpdate":Date.now(),"chunks":{}};console.log('WL.File.Transfer first chunk: '+path+' with '+content.length+' chars');}
else{this.WLFileReceiveBuffer[path]["lastUpdate"]=Date.now();console.log('WL.File.Transfer next chunk: '+path+' with '+content.length+' chars');}
this.WLFileReceiveBuffer[path]["chunks"][offset]={"content":content,"eof":eof};if(eof){var allOffsets=Object.keys(this.WLFileReceiveBuffer[path]["chunks"]);allOffsets.sort(function(a,b){return parseInt(a)-parseInt(b);});content='';for(var i=0;i<allOffsets.length;i++){var offset_1=allOffsets[i];if(content.length!=offset_1){console.log('WL.File.Transfer chunk lost for: '+path+'. Transfer failed/incomplete!');alert('WL.File.Transfer chunk lost for: '+path+'. Transfer failed/incomplete!');delete this.WLFileReceiveBuffer[path];return;}
content+=this.WLFileReceiveBuffer[path]["chunks"][offset_1]["content"];}
localStorage.setItem('WL.File.Transfer path',path);localStorage.setItem('WL.File.Transfer content',content);console.log('WL.File.Transfer reception complete: '+path);delete this.WLFileReceiveBuffer[path];}
if(!this.editorWindow||this.editorWindow.closed){document.getElementById('infoModalDlg-title').innerHTML='Fehler!';document.getElementById('infoModalDlg-content').innerHTML='Editor-Fenster konnte nicht '+'ge&ouml;ffnet werden oder ist nicht sichtbar! Pr&uuml;fe Deinen Browser oder Popup-Blocker!';this.micromodal.show('infoModalDlg');}};return GMCPHandler;}());wlClient.GMCPHandler=GMCPHandler;})(wlClient||(wlClient={}));var wlClient;(function(wlClient){var MenuHandler=(function(){function MenuHandler(){document.querySelector('.dropbtn').addEventListener('click',this.mainDropDownFunction.bind(this),false);}
MenuHandler.prototype.mainDropDownFunction=function(){var mainDropdown=document.getElementById('mainDropdown');if(mainDropdown.classList.contains('dropshow')){this.closeAllDropDowns();}
else{mainDropdown.classList.toggle('dropshow');}
document.getElementById('cmd').focus();};MenuHandler.prototype.settingsDropDownFunction=function(){document.getElementById('settingsDropdown').classList.toggle('dropshow');document.getElementById('cmd').focus();};MenuHandler.prototype.closeAllDropDowns=function(){var dropdowns=document.getElementsByClassName('dropdown-content');var i;for(i=0;i<dropdowns.length;i++){var openDropdown=dropdowns[i];if(openDropdown.classList.contains('dropshow')){openDropdown.classList.remove('dropshow');}}};MenuHandler.prototype.cmdButtonContextFunction=function(event){document.getElementById('cmdEdit').dataset.cmdButtonId=event.target.id;document.getElementById('cmdRemove').dataset.cmdButtonId=event.target.id;document.getElementById('cmdAdd1').dataset.cmdButtonId=event.target.id;document.getElementById('cmdAdd4').dataset.cmdButtonId=event.target.id;var ctxMenu=document.getElementById('cmdButtonsCtxMenu');ctxMenu.style.left=(event.pageX-150)+"px";ctxMenu.style.top=(event.pageY-40)+"px";ctxMenu.classList.toggle('dropshow');event.preventDefault();};MenuHandler.prototype.settingsButtonContextFunction=function(event){document.getElementById('settingsAdd1').dataset.cmdButtonId=event.target.id;document.getElementById('settingsAdd4').dataset.cmdButtonId=event.target.id;var ctxMenu=document.getElementById('settingsButtonsCtxMenu');ctxMenu.style.left=(event.pageX-150)+"px";ctxMenu.style.top=(event.pageY-40)+"px";ctxMenu.classList.toggle('dropshow');event.preventDefault();};MenuHandler.prototype.closeAllButtonContextFunction=function(){document.getElementById('cmdButtonsCtxMenu').classList.remove('dropshow');document.getElementById('settingsButtonsCtxMenu').classList.remove('dropshow');};return MenuHandler;}());wlClient.MenuHandler=MenuHandler;})(wlClient||(wlClient={}));var wlMacros;(function(wlMacros){var MacroProps=(function(){function MacroProps(){}
return MacroProps;}());var TriggerProps=(function(){function TriggerProps(){}
return TriggerProps;}());var EvaluationContext=(function(){function EvaluationContext(cmd){this.parameters=[];this.localVariables={};if(cmd){this.cmd=cmd;this.parameters=cmd.split(' ');this.localVariables={};}
else{this.cmd='';this.parameters=[];this.localVariables={};}}
EvaluationContext.prototype.isMacro=function(){return(this.cmd!=null&&this.cmd.length>0&&this.cmd.charAt(0)==MacroProcessor.MACRO_KEY);};EvaluationContext.prototype.getFirstWord=function(){if(this.parameters.length==0)
return'';var firstWord=this.parameters[0];return this.isMacro?firstWord.substr(1):firstWord;};return EvaluationContext;}());wlMacros.EvaluationContext=EvaluationContext;var Stack=(function(){function Stack(firstContext){this.content=[];this.stepCount=0;if(!firstContext)
firstContext=new EvaluationContext(null);this.content.push(firstContext);}
Stack.prototype.getCContext=function(){if(this.content.length==0){this.content.push(new EvaluationContext(null));}
return this.content[this.content.length-1];};Stack.prototype.getCCmd=function(){return this.content.length>0?this.content[this.content.length-1].cmd:'';};Stack.prototype.push=function(context){this.content.push(context);};Stack.prototype.pop=function(){return this.content.pop();};Stack.prototype.searchVariable=function(vName){var vValue=null;for(var i=this.content.length-1;i>=0;i--){vValue=this.content[i].localVariables[vName];if(vValue!=null)
break;}
return vValue;};return Stack;}());wlMacros.Stack=Stack;var EvalResult=(function(){function EvalResult(send,cmd,message){this.send=send;this.cmd=cmd;this.message=message;}
EvalResult.prototype.append=function(next){if(next){if(next.send===true)
this.send=true;this.cmd+=next.cmd;this.message+=next.message;}};return EvalResult;}());wlMacros.EvalResult=EvalResult;var MacroProcessor=(function(){function MacroProcessor(){this.customMacros={};this.globalVariables={'borg':'1','matching':'glob'};this.partialLineBufferForTrigger='';}
MacroProcessor.prototype.getVersion=function(){return MacroProcessor.VERSION;};MacroProcessor.prototype.maintainSpecialVariables=function(){var fixed=false;if(this.globalVariables['borg']==null||this.globalVariables['borg']==''){this.globalVariables['borg']='0';fixed=true;}
else if(this.globalVariables['borg']!='0'){this.globalVariables['borg']='1';fixed=true;}
var mMatching=this.globalVariables['matching'].toLowerCase();if(mMatching=='regex'){this.globalVariables['matching']='regexp';}
else if(mMatching!='simple'&&mMatching!='glob'&&mMatching!='regexp'){this.globalVariables['matching']='glob';fixed=true;}
return fixed;};MacroProcessor.prototype.saveSettings=function(){this.maintainSpecialVariables();localStorage.setItem(MacroProcessor.STORAGE_KEY_LIST,JSON.stringify(this.customMacros));localStorage.setItem(MacroProcessor.STORAGE_KEY_LISTVAR,JSON.stringify(this.globalVariables));};MacroProcessor.prototype.reloadSettings=function(){var updateRequired=false;try{var storedMacrosString=localStorage.getItem(MacroProcessor.STORAGE_KEY_LIST);if(storedMacrosString){var storedMacros=JSON.parse(storedMacrosString);this.customMacros={};var updateRequired_1=false;if(storedMacros){for(var mName in storedMacros){var mBody=storedMacros[mName];if(typeof mBody==='string'){var props=new MacroProps;props.body=mBody;this.customMacros[mName]=props;updateRequired_1=true;}
else{this.customMacros[mName]=mBody;}}}
else{updateRequired_1=true;}}
var storedGlobalVarsString=localStorage.getItem(MacroProcessor.STORAGE_KEY_LISTVAR);if(storedGlobalVarsString){var storedGlobalVars=JSON.parse(storedGlobalVarsString);this.globalVariables={};if(storedGlobalVars){this.globalVariables=storedGlobalVars;}}
if(this.maintainSpecialVariables())
updateRequired=true;if(updateRequired)
this.saveSettings();}
catch(e){console.log('Macro processor: '+e.name+': '+e.message);}};MacroProcessor.prototype.getNamedKey=function(event){var keyName='';if(['Unidentified','Alt','AltGraph','CapsLock','Control','Fn','FnLock','Hyper','Meta','NumLock','ScrollLock','Shift','Super','Symbol','SymbolLock','OS','Insert','Backspace','Delete'].indexOf(event.key)==-1){keyName='key_';if(event.ctrlKey)
keyName+='ctrl_';if(event.altKey)
keyName+='alt_';if(event.shiftKey)
keyName+='shift_';if(event.metaKey)
keyName+='meta_';keyName+=event.key==' '?'Space':event.key;}
return keyName;};MacroProcessor.prototype.keyTrigger=function(event){var result=new EvalResult(false,'','');var keyName=this.getNamedKey(event);if(keyName.length>0){if(this.customMacros[keyName]){result=this.expandMacro(new Stack(new EvaluationContext('/'+keyName)));}
if(!result.send){result.cmd='';result.message='';if(['F1','F2','F3','F4','F5','F6','F7','F8','F9','F10','F11','F12','F13','F14','F15','F16','F17','F18','F19','F20','F21','F22','F23','F24',].indexOf(event.key)!=-1){result.message='% The key "'+keyName+'" is undefined; you may use "/def '+keyName+' = <commands>" to define it.\n';}}}
return result;};MacroProcessor.prototype.textTrigger=function(text){var result=new EvalResult(false,'','');if(this.globalVariables['borg']=='0'){this.partialLineBufferForTrigger='';return result;}
if(text.length>0){text=this.partialLineBufferForTrigger.concat(text);this.partialLineBufferForTrigger='';var lines=text.split(/\r?\n/);this.partialLineBufferForTrigger=lines.pop();var picomatch=require('picomatch');for(var i=0;i<lines.length;i++){for(var mName in this.customMacros){var mProps=this.customMacros[mName];if(mProps.trigger!=null&&mProps.trigger.pattern!=null&&mProps.trigger.pattern.length>0){if(mProps.trigger.matching=='simple'){if(lines[i]==mProps.trigger.pattern){console.log('% trigger match simple pattern of: '+mName);var context=new EvaluationContext('/'+mName);context.parameters.push(lines[i]);context.localVariables['P0']=lines[i];result.append(this.expandMacro(new Stack(context)));}}
else if(mProps.trigger.matching=='glob'){var mResult=picomatch.compileRe(picomatch.parse(mProps.trigger.pattern)).exec(lines[i]);if(mResult){console.log('% trigger match glob pattern of: '+mName);var context=new EvaluationContext('/'+mName);for(var p=0;;p++){if(!mResult[p])
break;context.parameters.push(mResult[p]);context.localVariables['P'+p]=mResult[p];}
context.localVariables['PL']=lines[i].substr(0,mResult.index);context.localVariables['PR']=lines[i].substr(mResult.index+mResult[0].length);result.append(this.expandMacro(new Stack(context)));}}
else if(mProps.trigger.matching=='regexp'){var regex=new RegExp(mProps.trigger.pattern);var mResult=regex.exec(lines[i]);if(mResult){console.log('% trigger match regexp pattern of: '+mName);var context=new EvaluationContext('/'+mName);for(var p=0;;p++){if(!mResult[p])
break;context.parameters.push(mResult[p]);context.localVariables['P'+p]=mResult[p];}
context.localVariables['PL']=lines[i].substr(0,mResult.index);context.localVariables['PR']=lines[i].substr(mResult.index+mResult[0].length);result.append(this.expandMacro(new Stack(context)));}}
else{console.log('MacroProcessor macro \''+mName+'\' invalid trigger matching: '+mProps.trigger.matching+' detected');}}}}}
return result;};MacroProcessor.prototype.getQuotedString=function(source,quoteChar){var quoted='';if(source.charAt(0)!=quoteChar)
return quoted;for(var i=1;i<source.length;i++){if(source.charAt(i)==quoteChar){var bs=0;for(var k=i-1;k>0;k--){if(source.charAt(k)=='\\'){bs++;continue;}
break;}
if(bs%2==0){quoted=source.substr(0,i+1);break;}}}
return quoted;};MacroProcessor.prototype.handleDEF=function(stack){var result=new EvalResult(false,'','');var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();var mPattern='';var mMatching='';var body=myContext.cmd.substr(4).trim();while(body.length>0&&body.charAt(0)=='-'){if(body.length<2){result.message='% '+firstWord+': missing option -\n';return result;}
if(body.charAt(1)=='t'){mPattern=this.getQuotedString(body.substr(2),'"');if(!mPattern||mPattern.length==0){result.message='% '+firstWord+': invalid/incomplete trigger option, quotes missing?\n';return result;}
else if(mPattern.length==2){result.message='% '+firstWord+': empty trigger found\n';return result;}
else{body=body.substr(mPattern.length+2).trim();mPattern=mPattern.substr(1,mPattern.length-2);}}
else if(body.charAt(1)=='m'){if(body.indexOf('-msimple ')==0){mMatching='simple';body=body.substr(9).trim();}
else if(body.indexOf('-mglob ')==0){mMatching='glob';body=body.substr(7).trim();}
else if(body.indexOf('-mregexp ')==0){mMatching='regexp';body=body.substr(9).trim();}
else{result.message='% '+firstWord+': matching option must be: -msimple, -mglob or -mregexp\n';return result;}}
else{result.message='% '+firstWord+': unknown option -'+body.charAt(1)+'\n';return result;}}
var eqSign=body.indexOf("=");if(eqSign>0){var mName=body.substring(0,eqSign).trim();var mBody=body.substring(eqSign+1).trim();if(mName.length>0){if(mPattern.length>0){if(mMatching.length==0)
mMatching=this.globalVariables['matching'];if(mMatching=='glob'){var picomatch=require('picomatch');try{var regex=picomatch.compileRe(picomatch.parse(mPattern));}
catch(error){result.message='% '+firstWord+': glob error: '+error+'\n';return result;}}
else if(mMatching=='regexp'){try{var regex=new RegExp(mPattern);}
catch(error){result.message='% '+firstWord+': regexp error: '+error+'\n';return result;}}}
else{mMatching='';}
if(this.customMacros[mName]!=null&&this.customMacros[mName].body!==mBody){result.message='% '+firstWord+': redefined macro '+mName+'\n';}
var macro=new MacroProps;macro.body=mBody;macro.trigger=new TriggerProps;macro.trigger.pattern=mPattern;macro.trigger.matching=mMatching;this.customMacros[mName]=macro;this.saveSettings();}
else{result.message='% '+firstWord+': &lt;name&gt; must not be empty\n';}}
else if(eqSign==0){result.message='% '+firstWord+': &lt;name&gt; missing, try: /def &lt;name&gt; = &lt;body&gt;\n';}
else{result.message='% '+firstWord+': \'=\' missing, try: /def &lt;name&gt; = &lt;body&gt;\n';}
return result;};MacroProcessor.prototype.handleUNDEF=function(stack){var result=new EvalResult(false,'','');var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();for(var i=1;i<myContext.parameters.length;i++){if(myContext.parameters[i].length>0){if(!this.customMacros[myContext.parameters[i]]){result.message+='% '+firstWord+': macro "'+myContext.parameters[i]+'" was not defined.\n';}
else{delete this.customMacros[myContext.parameters[i]];this.saveSettings();}}}
return result;};MacroProcessor.prototype.handleLIST=function(stack){var result=new EvalResult(false,'','');var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();var picomatch=null;if(myContext.parameters.length>1){picomatch=require('picomatch');}
var sortedKeys=Object.keys(this.customMacros).sort();for(var i=0;i<sortedKeys.length;i++){if(!picomatch||picomatch.isMatch(sortedKeys[i],myContext.parameters.slice(1))){var macroProps=this.customMacros[sortedKeys[i]];result.message+='/def ';if(macroProps.trigger!=null&&macroProps.trigger.pattern!=null&&macroProps.trigger.pattern.length>0){result.message+='-m'+macroProps.trigger.matching+' ';result.message+='-t"'+macroProps.trigger.pattern+'" ';}
result.message+=(sortedKeys[i]+' = '+macroProps.body+'\n');}}
if(result.message.length==0)
result.message='% '+firstWord+': no macros found.\n';return result;};MacroProcessor.prototype.substituteVariables=function(text,stack){var oldBody=text;var newBody='';var deadEndLimit=42;var myContext=stack.getCContext();var globVars=this.globalVariables;while(deadEndLimit--){newBody=oldBody.replace(/(%{[^ -]*?})/,function(m){var strippedM=m.substr(2,m.length-3);if(strippedM=='#'){return''+myContext.parameters.length+'';}
else if(strippedM=='*'){return''+myContext.parameters.slice(1).join(' ')+'';}
else{var parsedM=parseInt(strippedM);if(isNaN(parsedM)){var vValue=stack.searchVariable(strippedM);if(vValue!=null)
return vValue;vValue=globVars[strippedM];if(vValue!=null)
return vValue;return'';}
else{if(parsedM<myContext.parameters.length){return myContext.parameters[parsedM];}
else{return'';}}}});if(newBody!=oldBody){oldBody=newBody;}
else
break;}
return newBody;};MacroProcessor.prototype.handleSET=function(stack){var result=new EvalResult(false,'','');var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();var body=myContext.cmd.substr(4).trim();var wsSign=body.indexOf(" ");var eqSign=body.indexOf("=");var vName='';var vValue=null;if(eqSign>=0&&(wsSign<0||eqSign<wsSign)){vName=body.substring(0,eqSign).trim();vValue=body.substring(eqSign+1);}
else if(wsSign>0){vName=body.substring(0,wsSign).trim();vValue=body.substring(wsSign+1).trim();if(vValue.length==0)
vValue=null;}
else{vName=body;}
if(vName.length>0&&vValue!=null){if(this.globalVariables[vName]!=null&&this.globalVariables[vName]!==vValue){result.message='% '+firstWord+': redefined variable '+vName+'\n';}
this.globalVariables[vName]=vValue;this.saveSettings();}
else if(vName.length==0&&vValue!=null&&vValue.length>0){result.message='% '+firstWord+': &lt;name&gt; must not be empty\n';}
else if(vName.length==0){return this.handleLISTVAR(stack);}
else{if(this.globalVariables[vName]!=null){result.message='% '+vName+'='+this.globalVariables[vName]+'\n';}
else{result.message='% '+vName+' not set globally\n';}}
return result;};MacroProcessor.prototype.handleUNSET=function(stack){var result=new EvalResult(false,'','');var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();for(var i=1;i<myContext.parameters.length;i++){if(myContext.parameters[i].length>0){if(!this.globalVariables[myContext.parameters[i]]){result.message+='% '+firstWord+': global variable "'+myContext.parameters[i]+'" was not defined.\n';}
else{delete this.globalVariables[myContext.parameters[i]];this.saveSettings();}}}
return result;};MacroProcessor.prototype.handleLISTVAR=function(stack){var result=new EvalResult(false,'','');var picomatch=null;var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();if(myContext.parameters.length>1){picomatch=require('picomatch');}
var sortedKeys=Object.keys(this.globalVariables).sort();for(var i=0;i<sortedKeys.length;i++){if(!picomatch||picomatch.isMatch(sortedKeys[i],myContext.parameters.slice(1))){var vValue=this.globalVariables[sortedKeys[i]];result.message+='/set '+sortedKeys[i]+'='+vValue+'\n';}}
if(result.message.length==0)
result.message='% '+firstWord+': no global variables found.\n';return result;};MacroProcessor.prototype.handleLET=function(stack){var result=new EvalResult(false,'','');var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();var body=myContext.cmd.substr(4).trim();var wsSign=body.indexOf(" ");var eqSign=body.indexOf("=");var vName='';var vValue=null;if(eqSign>=0&&(wsSign<0||eqSign<wsSign)){vName=body.substring(0,eqSign).trim();vValue=body.substring(eqSign+1);}
else if(wsSign>0){vName=body.substring(0,wsSign).trim();vValue=body.substring(wsSign+1).trim();if(vValue.length==0)
vValue=null;}
else{vName=body;}
if(vName.length>0&&vValue!=null){myContext.localVariables[vName]=vValue;}
else if(vName.length==0){result.message='% '+firstWord+': &lt;name&gt; must not be empty\n';}
else{result.message='% '+firstWord+': &lt;value&gt; must not be empty\n';}
return result;};MacroProcessor.prototype.handleHELP=function(stack){var result=new EvalResult(false,'','');var myContext=stack.getCContext();var topic=myContext.parameters.length>1?myContext.parameters[1].toLowerCase():'';result.message=new wlMacros.MacroHelp(topic).getHelp();return result;};MacroProcessor.prototype.handleCUSTOM=function(stack){var result=new EvalResult(false,'','');var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();if(this.customMacros[firstWord]!=null){var body=this.customMacros[firstWord].body;var steps=body.split(MacroProcessor.TF_SEPARATOR_TOKEN);var stepNums=steps.length;if(stepNums>42){result.message='% '+firstWord+': command list truncated to 42 for some reason, sorry\n';stepNums=42;}
for(var i=0;i<stepNums;i++){var step=this.substituteVariables(steps[i],stack);if(steps[i].length>0&&steps[i].charAt(0)==MacroProcessor.MACRO_KEY){stack.push(new EvaluationContext(step));var childResult=this.resolveSingle(stack);if(childResult.send===true)
result.send=true;result.cmd+=childResult.cmd;result.message+=childResult.message;}
else{result.cmd+=(step+'\n');}}
result.send=true;}
else{result.message='% '+firstWord+': no such command or macro\n';}
return result;};MacroProcessor.prototype.expandMacro=function(stack){var result;if(stack==null)
throw new Error("Argument 'stack' must not be null.");var myContext=stack.getCContext();var firstWord=myContext.getFirstWord();if(firstWord.length>0){if(stack.stepCount<MacroProcessor.MAX_RECUR){stack.stepCount++;switch(firstWord.toLowerCase()){case'def':result=this.handleDEF(stack);break;case'undef':result=this.handleUNDEF(stack);break;case'list':result=this.handleLIST(stack);break;case'set':result=this.handleSET(stack);break;case'unset':result=this.handleUNSET(stack);break;case'listvar':result=this.handleLISTVAR(stack);break;case'let':result=this.handleLET(stack);break;case'help':result=this.handleHELP(stack);break;default:result=this.handleCUSTOM(stack);break;}
stack.stepCount--;}
else{result=new EvalResult(false,'','% '+firstWord+': maximum recursion limit ('+stack.stepCount+') reached.\n');}}
else{result=new EvalResult(true,myContext.cmd+'\n','');}
return result;};MacroProcessor.prototype.resolveSingle=function(stack){var result;if(!stack)
throw new Error('Argument stack must not be null.');if(!stack.getCContext())
throw new Error('Argument stack must not be empty.');if(stack.getCContext().isMacro()){result=this.expandMacro(stack);}
else{result=new EvalResult(true,stack.getCCmd()+'\n','');}
return result;};MacroProcessor.prototype.resolve=function(text){var result=new EvalResult(false,'','');var lines=text.split(/\r?\n/);for(var i=0;i<lines.length;i++){result.append(this.resolveSingle(new Stack(new EvaluationContext(lines[i]))));}
return result;};MacroProcessor.VERSION='0.4';MacroProcessor.MACRO_KEY='/';MacroProcessor.STORAGE_KEY_LIST='Macros.List';MacroProcessor.STORAGE_KEY_LISTVAR='Macros.ListVar';MacroProcessor.MAX_RECUR=42;MacroProcessor.TF_SEPARATOR_TOKEN='%;';return MacroProcessor;}());wlMacros.MacroProcessor=MacroProcessor;})(wlMacros||(wlMacros={}));var wlMacros;(function(wlMacros){var MacroHelp=(function(){function MacroHelp(topic){this.topic='';this.topic=topic.trim().toLowerCase();if(this.topic.charAt(0)==wlMacros.MacroProcessor.MACRO_KEY)
this.topic=topic.substr(1);}
MacroHelp.prototype.getHelp=function(){switch(this.topic){case'def':return'\n'+'Help on: /def\n'+'\n'+'Usage: /def [-m&lt;matching&gt;] [-t"&lt;pattern&gt;"] &lt;name&gt; = &lt;body&gt;\n'+'\n'+'Defines a named macro. The &lt;name&gt; can be anything, but must not '+'contain whitespaces. The &lt;body&gt; is the text to be executed as a user command. Multiple '+'commands can be separated by token \'%;\'. An optional trigger pattern may be defined to '+'automatically execute the body on a certain message. The optional matching type defines the '+'pattern style. Default is \'glob\' style. Simple macro without triggers:\n'+'\n'+'  /def time_warp = :jumps to the left!%;:steps to the right!\n'+'\n'+'and call it by typing\n'+'\n'+'  /time_warp\n'+'\n'+'you will execute the commands\n'+'\n'+':jumps to the left!\n'+':steps to the right!\n'+'\n'+'You can execute a macro by typing \'/\' followed by the name of the macro. Macros can call '+'other macros, including itself, but recursion is limited to avoid eternal loops.\n\n'+'See: /list, /undef, substitution, triggers\n';break;case'undef':return'\n'+'Help on: /undef\n'+'\n'+'Usage: /undef &lt;name&gt;\n'+'\n'+'Undefines a named macro. No options provided. It is the counterpart to /def. I have no '+'idea, why you would ever need it, but it exists. For you.\n\n'+'See: /def, /list, substitution\n';break;case'list':return'\n'+'Help on: /list\n'+'\n'+'Usage: /list [pattern]\n'+'\n'+'Lists all currently defined macros, sorted alphabetically. If [pattern] is provided, only '+'macros with a matching name are listed.\n\n'+'See: /def, /undef, substitution\n';break;case'trigger':case'triggers':return'\n'+'Help on: triggers\n'+'\n'+'Example 1: /def -msimple -t"Gast1 kommt an." greet1 kicher\n'+'           Defines a simple trigger macro with name \'greet1\', which body will be\n'+'           evaluated, whenever the client receives a matching line, like (e.g.):\n'+'           Gast1 kommt an.\n'+'           As a result the player will just giggle.\n\n'+'Example 2: /def -mglob -t"(*) kommt an." greet2 winke %{P1}\n'+'           Defines a glob-style trigger macro with name \'greet2\', which body will be\n'+'           evaluated, whenever the client receives a matching line, like (e.g.):\n'+'           Gast1 kommt an. (or) Twinsen kommt an. (or) Fuchur kommt an.\n'+'           As a result the player will wave Gast1, Twinsen or Fuchur.\n\n'+'Example 3: /def -mregexp -t"^(\\w+) geht nach (\\w+)." greet3 = teile %{P1} mit Viel Spass im %{P2}!\n'+'           Defines a regexp-style trigger macro with name \'greet3\', which body will\n'+'           be evaluated, whenever the client receives a matching line, like (e.g.):\n'+'           Elvira geht nach Osten. (or) Fiona geht nach Norden.\n'+'           As a result the player will tell Elvira to have much fun in the \'Osten\'.\n'+'           or Fiona to have much fun in the \'Norden\'.\n\n'+'\n'+'More coming soon!\n\n'+'See: /def, /undef, /list\n';case'set':return'\n'+'Help on: /set\n'+'\n'+'Usage: /set &lt;name&gt;=&lt;value&gt;\n'+'       /set [&lt;name&gt; [&lt;value&gt;]]\n'+'\n'+'Sets the value of a globale variable (first syntax) or displays the value of a global '+'variable, if no value is provided. If no value and no name is provided is provided, all '+'global variables will be listed.\n\n'+'See: /listvar, /unset, /let, variables\n';break;case'unset':return'\n'+'Help on: /unset\n'+'\n'+'Usage: /unset &lt;name&gt;\n'+'\n'+'Removes the value of a globale variable.\n\n'+'See: /listvar, /set, /let, variables\n';break;case'listvar':return'\n'+'Help on: /listvar\n'+'\n'+'Usage: /listvar [&lt;name&gt;]\n'+'\n'+'Lists global variables and displays their values. A glob pattern may be used to filter the '+'displayes variables.\n\n'+'See: /set, /unset, /let, variables\n';break;case'let':return'\n'+'Help on: /let\n'+'\n'+'Usage: /let &lt;name&gt;=&lt;value&gt;\n'+'       /let &lt;name&gt; &lt;value&gt;\n'+'\n'+'Assigns a value to a local variable, which exists only while another macro is evaluated '+'and in child evaluation contexts. So it may be used for temporary data, while macros are '+'cascaded. Local variables shadow global variables and local variables, which were defined '+'in a higher context.\n\n'+'See: /listvar, /set, /unset, variables\n';break;case'variables':return'\n'+'Help on: variables\n'+'\n'+'There are global variables, special global variables, local variables and macro parameters. '+'Global variables may be defined by /set anytime and will be stored in the localStorage of '+'your browser. Local variables are defined with /let and exist only during macro evaluation. '+'Macro parameters may be used by substitution to pass arguments to macros. Special global '+'variables have default values and usually can only be set to predefined values.\n\n'+'Special variables:\n\n'+'borg=1\n'+'    If set to 1, triggers are enabled, is set to 0 all triggers are disabled.\n\n'+'matching=glob\n'+'    Sets the default trigger matching style, when creating new triggers:\n'+'    One of: \'simple\', \'glob\' (default) or \'regexp\'\n\n'+'NOTE: Special global variables may be reserved in the future for special purpose settings.\n'+'Export your client settings to save your custom macros and variables permanently!\n\n'+'See: /listvar, /set, /unset, /let, substitution, triggers\n';break;case'substitution':return'\n'+'Help on: substitution\n'+'\n'+'Macros may use global or local variables or parameters for substitute portions of the macro '+'body. The substitution pattern has always the form (brackets are not optional!):\n\n'+' %{selector}\n\n'+'The <i>selector</i> may be:\n'+' name          - the name of a global or local variable, e.g. %{foo}\n'+' #             - the the number of existing macro parameters\n'+' 0             - the name of the current evaluated macro\n'+' 1, 2, 3, etc. - positional macro parameters, e.g. %{1}\n'+' *             - selects all positional parameters except 0 (1 2 3 etc.)\n'+' Pn            - Result of the last successful RegExp or Glob subexpression,\n'+'                 n is a positive number. %{P0} expands to the complete text\n'+'                 matched, %{P1} matches the first parenthesised subexpression,\n'+'                 %{P2} the second etc. If \'n\' exceeds the number of matched\n'+'                 subexpressions, it expands to an empty string.\n'+' PL            - expands to the text left of matched text (%{P0}).\n'+' PR            - expands to the text left of matched text (%{P0}).\n'+'\n'+'More selectors may be available in the future.\n\n'+'See: /listvar, /set, /unset, /let, variables\n';break;default:return'\n'+'Tiny Macro Processor V'+wlMacros.MacroProcessor.VERSION+'\n'+'~~~~~~~~~~~~~~~~~~~~~~~~~~\n'+'The macro processor is an optional and experimental component of the Wunderland '+'web-client and provides tools to define and execute macros. These macros '+'may define scripts to do complex or repetetive tasks. One typical use case is '+'the definition of long routes to walk through the MUD. The number of commands per '+'macro and the number of recursion steps is limited. Any feature may change anytime '+'and the processor may disappear completely in the future, without further notice.\n'+'\n'+'Additional help pages: /help &lt;command/topic &gt; (without \'/\')\n\n'+'Commands:\n'+' /def     - define a named macro\n'+' /undef   - undefine a named macro\n'+' /list    - display a list of macros\n'+' /set     - set a global variable\n'+' /unset   - unset a global variable\n'+' /listvar - list all global variables, including special variables\n'+' /let     - set the value of a local variable\n\n'+'Other topics:\n'+' variables    - \n'+' substitution - \n'+' triggers     - \n\n'+'NOTE: The macros are stored in your browsers localStorage only. Export your client settings '+'to save them permanently!\n\n'+'See: /def, /undef, /list, /set, /unset, /listvar, /let, variables, substitution, triggers\n';}};return MacroHelp;}());wlMacros.MacroHelp=MacroHelp;})(wlMacros||(wlMacros={}));